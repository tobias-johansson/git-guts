<!DOCTYPE>

<html>

<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>

    <script src="https://cdn.rawgit.com/cpettitt/dagre/v0.7.4/dist/dagre.min.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-dagre/1.1.2/cytoscape-dagre.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/agate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>

    <script>
			$(function(){

				var layout = {
  				    name: 'dagre',
  				    //name: 'circle',
  				    //name: 'grid',
  				    //name: 'concentric',
  				    name: 'breadthfirst',
                    //directed: true
					    //rankDir: 'LR',
				}
				var cy = window.cy = cytoscape({
					container: $('#cy'),
					layout: layout,
					style: [
						{
							selector: 'node',
							style: {
								'content': 'data(label)',
								'text-wrap': 'wrap',
								'shape': 'rectangle',
								'width': 'label',
								'height': 'label',
								'padding-left':   '1em',
								'padding-right':  '1em',
								'padding-top':    '1em',
								'padding-bottom': '1em',
								'font-family': 'monospace',
								'text-valign': 'center',
								'text-halign': 'center',
								'background-color': '#222',
								'font-size': '10px'
							}
						}, {
                            selector: 'node.commit',
							style: {
							    'background-color': '#f55',
							}
						}, {
						    selector: 'node.tree',
							style: {
							    'background-color': '#55f',
							}
						}, {
							selector: 'node.file',
							style: {
							    'background-color': '#5f5',
							}
						}, {
							selector: 'edge',
							style: {
							    'content': 'data(label)',
								'width': 3,
								'target-arrow-shape': 'triangle',
								'curve-style': 'bezier',
								'font-family': 'monospace',
								'font-size': '10px'
							}
						}, {
							selector: 'edge.commit',
							style: {
								'line-color': '#500',
								'target-arrow-color': '#500',
							}
						}, {
							selector: 'edge.tree',
							style: {
								'line-color': '#050',
								'target-arrow-color': '#050',
							}
						}, {
							selector: 'edge.file',
							style: {
								'line-color': '#005',
								'target-arrow-color': '#005',
							}
						}
					],
					boxSelectionEnabled: false,
					wheelSensitivity: 0.5
				});

				cy.on('tap', 'node', function(evt){
				  var node = evt.cyTarget;
				  console.log( 'tapped ' + node.id() );
					info = node.data().info
					$('#header h1').html(info.name);
					var info_str = JSON.stringify(info, null, 2);
					$('#info code').html(info_str);
					$('#info code').each(function(i, block) {
    				hljs.highlightBlock(block);
  				});
				});

				$.when(
					$.get("/api/nodes"),
					$.get("/api/edges")
				).done(function (ns, es) {
					cy.add({
						nodes: ns[0].nodes,
						edges: es[0].edges
					});
					cy.layout(layout);
				});

			});
		</script>


    <style>
			html,body {
					padding:0;
					margin:0;
					height:100%;
					font-family: monospace;
				}

				#cy {
					width: 100%;
					height: 100%;
					float: left;
					font-size: 10px;
				}

		</style>
    <title>dv</title>
</head>

<body>
<div id="cy"></div>
</div>

</body>

</html>
